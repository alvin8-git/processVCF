# =============================================================================
# docker-compose.yml for processVCF Pipeline
# =============================================================================
# Usage:
#   1. Build: docker-compose build
#   2. Run:   docker-compose run --rm processvcf
#
# Prerequisites:
#   - Databases directory at ${HOME}/Databases
#   - VEP installation at ${HOME}/Software/ensembl-vep (optional)
#
# Permission Handling:
#   The entrypoint script automatically handles /data permissions by:
#   1. Starting as root
#   2. Fixing /data ownership to container user
#   3. Dropping privileges to run as 'user'
#   No manual user:group configuration needed.
# =============================================================================

version: '3.8'

services:
  processvcf:
    build: .
    image: processvcf:latest
    container_name: processvcf
    volumes:
      # Mount databases (required for full operation)
      - ${HOME}/Databases:/home/user/Databases:ro

      # Mount VEP (optional - large installation)
      - ${HOME}/Software/ensembl-vep:/home/user/Software/ensembl-vep:ro

      # Mount data directory for processing (read-write)
      # Permissions handled automatically by entrypoint.sh
      - ./data:/data

    working_dir: /data
    stdin_open: true
    tty: true

  # Alternative minimal configuration (specific databases only)
  processvcf-minimal:
    build: .
    image: processvcf:latest
    volumes:
      # Specific database paths
      - ${HOME}/Databases/humandb:/home/user/Databases/humandb:ro
      - ${HOME}/Databases/WholeGenomeFASTA:/home/user/Databases/WholeGenomeFASTA:ro
      - ${HOME}/Databases/TMSPvcf:/home/user/Databases/TMSPvcf:ro
      - ${HOME}/Databases/Ensembldata:/home/user/Databases/Ensembldata:ro
      - ${HOME}/Databases/snpEff:/home/user/Databases/snpEff:ro
      # Data directory (permissions handled by entrypoint.sh)
      - ./data:/data
    working_dir: /data
    stdin_open: true
    tty: true
